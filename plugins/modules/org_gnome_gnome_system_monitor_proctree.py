#!/usr/bin/python
# -*- coding: utf-8 -*-

# Copyright (c) 2023, Jules
# All rights reserved.

from __future__ import absolute_import, division, print_function
__metaclass__ = type

DOCUMENTATION = r'''
---
module: org_gnome_gnome_system_monitor_proctree
short_description: Manages GNOME GSettings for org.gnome.gnome-system-monitor.proctree
description:
  - >
    This module allows for the configuration of GSettings keys within the 'org.gnome.gnome-system-monitor.proctree' schema.
  - >
    It supports setting default values and locking keys to enforce system-wide policies.
author:
  - Autogenerated by ansible-gnome-lockdown
version_added: "1.1.0"
options:
  sort-col:
    description:
    - Process view sort column
    - Description - Schema Blank
    type: int
    default: 8

  sort-col_locked:
    description:
    - >
      If set to true, locks the 'sort-col' key to prevent user modification.
    type: bool
    default: false
  columns-order:
    description:
    - Process view columns order
    - Description - Schema Blank
    type: str
    default:
    - 0
    - 12

  columns-order_locked:
    description:
    - >
      If set to true, locks the 'columns-order' key to prevent user modification.
    type: bool
    default: false
  sort-order:
    description:
    - Process view sort order
    - Description - Schema Blank
    type: int
    default: 0

  sort-order_locked:
    description:
    - >
      If set to true, locks the 'sort-order' key to prevent user modification.
    type: bool
    default: false
  col-0-width:
    description:
    - "Width of process \u201CName\u201D column"
    - Description - Schema Blank
    type: int
    default: 225

  col-0-width_locked:
    description:
    - >
      If set to true, locks the 'col-0-width' key to prevent user modification.
    type: bool
    default: false
  col-0-visible:
    description:
    - "Show process \u201CName\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: true

  col-0-visible_locked:
    description:
    - >
      If set to true, locks the 'col-0-visible' key to prevent user modification.
    type: bool
    default: false
  col-1-width:
    description:
    - "Width of process \u201CUser\u201D column"
    - Description - Schema Blank
    type: int
    default: 98

  col-1-width_locked:
    description:
    - >
      If set to true, locks the 'col-1-width' key to prevent user modification.
    type: bool
    default: false
  col-1-visible:
    description:
    - "Show process \u201CUser\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-1-visible_locked:
    description:
    - >
      If set to true, locks the 'col-1-visible' key to prevent user modification.
    type: bool
    default: false
  col-2-width:
    description:
    - "Width of process \u201CStatus\u201D column"
    - Description - Schema Blank
    type: int
    default: 37

  col-2-width_locked:
    description:
    - >
      If set to true, locks the 'col-2-width' key to prevent user modification.
    type: bool
    default: false
  col-2-visible:
    description:
    - "Show process \u201CStatus\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-2-visible_locked:
    description:
    - >
      If set to true, locks the 'col-2-visible' key to prevent user modification.
    type: bool
    default: false
  col-3-width:
    description:
    - "Width of process \u201CVirtual Memory\u201D column"
    - Description - Schema Blank
    type: int
    default: 90

  col-3-width_locked:
    description:
    - >
      If set to true, locks the 'col-3-width' key to prevent user modification.
    type: bool
    default: false
  col-3-visible:
    description:
    - "Show process \u201CVirtual Memory\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-3-visible_locked:
    description:
    - >
      If set to true, locks the 'col-3-visible' key to prevent user modification.
    type: bool
    default: false
  col-4-width:
    description:
    - "Width of process \u201CResident Memory\u201D column"
    - Description - Schema Blank
    type: int
    default: 90

  col-4-width_locked:
    description:
    - >
      If set to true, locks the 'col-4-width' key to prevent user modification.
    type: bool
    default: false
  col-4-visible:
    description:
    - "Show process \u201CResident Memory\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-4-visible_locked:
    description:
    - >
      If set to true, locks the 'col-4-visible' key to prevent user modification.
    type: bool
    default: false
  col-5-width:
    description:
    - "Width of process \u201CWritable Memory\u201D column"
    - Description - Schema Blank
    type: int
    default: 90

  col-5-width_locked:
    description:
    - >
      If set to true, locks the 'col-5-width' key to prevent user modification.
    type: bool
    default: false
  col-5-visible:
    description:
    - "Show process \u201CWritable Memory\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-5-visible_locked:
    description:
    - >
      If set to true, locks the 'col-5-visible' key to prevent user modification.
    type: bool
    default: false
  col-6-width:
    description:
    - "Width of process \u201CShared Memory\u201D column"
    - Description - Schema Blank
    type: int
    default: 90

  col-6-width_locked:
    description:
    - >
      If set to true, locks the 'col-6-width' key to prevent user modification.
    type: bool
    default: false
  col-6-visible:
    description:
    - "Show process \u201CShared Memory\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-6-visible_locked:
    description:
    - >
      If set to true, locks the 'col-6-visible' key to prevent user modification.
    type: bool
    default: false
  col-7-width:
    description:
    - "Width of process \u201CX Server Memory\u201D column"
    - Description - Schema Blank
    type: int
    default: 90

  col-7-width_locked:
    description:
    - >
      If set to true, locks the 'col-7-width' key to prevent user modification.
    type: bool
    default: false
  col-7-visible:
    description:
    - "Show process \u201CX Server Memory\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-7-visible_locked:
    description:
    - >
      If set to true, locks the 'col-7-visible' key to prevent user modification.
    type: bool
    default: false
  col-8-width:
    description:
    - "Width of process \u201CCPU %\u201D column"
    - Description - Schema Blank
    type: int
    default: 71

  col-8-width_locked:
    description:
    - >
      If set to true, locks the 'col-8-width' key to prevent user modification.
    type: bool
    default: false
  col-8-visible:
    description:
    - "Show process \u201CCPU %\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: true

  col-8-visible_locked:
    description:
    - >
      If set to true, locks the 'col-8-visible' key to prevent user modification.
    type: bool
    default: false
  col-9-width:
    description:
    - "Width of process \u201CCPU Time\u201D column"
    - Description - Schema Blank
    type: int
    default: 80

  col-9-width_locked:
    description:
    - >
      If set to true, locks the 'col-9-width' key to prevent user modification.
    type: bool
    default: false
  col-9-visible:
    description:
    - "Show process \u201CCPU Time\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-9-visible_locked:
    description:
    - >
      If set to true, locks the 'col-9-visible' key to prevent user modification.
    type: bool
    default: false
  col-10-width:
    description:
    - "Width of process \u201CStarted\u201D column"
    - Description - Schema Blank
    type: int
    default: 70

  col-10-width_locked:
    description:
    - >
      If set to true, locks the 'col-10-width' key to prevent user modification.
    type: bool
    default: false
  col-10-visible:
    description:
    - "Show process \u201CStarted\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-10-visible_locked:
    description:
    - >
      If set to true, locks the 'col-10-visible' key to prevent user modification.
    type: bool
    default: false
  col-11-width:
    description:
    - "Width of process \u201CNice\u201D column"
    - Description - Schema Blank
    type: int
    default: 48

  col-11-width_locked:
    description:
    - >
      If set to true, locks the 'col-11-width' key to prevent user modification.
    type: bool
    default: false
  col-11-visible:
    description:
    - "Show process \u201CNice\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-11-visible_locked:
    description:
    - >
      If set to true, locks the 'col-11-visible' key to prevent user modification.
    type: bool
    default: false
  col-12-width:
    description:
    - "Width of process \u201CID\u201D column"
    - Description - Schema Blank
    type: int
    default: 60

  col-12-width_locked:
    description:
    - >
      If set to true, locks the 'col-12-width' key to prevent user modification.
    type: bool
    default: false
  col-12-visible:
    description:
    - "Show process \u201CID\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: true

  col-12-visible_locked:
    description:
    - >
      If set to true, locks the 'col-12-visible' key to prevent user modification.
    type: bool
    default: false
  col-13-width:
    description:
    - "Width of process \u201CSELinux Security Context\u201D column"
    - Description - Schema Blank
    type: int
    default: 80

  col-13-width_locked:
    description:
    - >
      If set to true, locks the 'col-13-width' key to prevent user modification.
    type: bool
    default: false
  col-13-visible:
    description:
    - "Show process \u201CSELinux Security Context\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-13-visible_locked:
    description:
    - >
      If set to true, locks the 'col-13-visible' key to prevent user modification.
    type: bool
    default: false
  col-14-width:
    description:
    - "Width of process \u201CCommand Line\u201D column"
    - Description - Schema Blank
    type: int
    default: 120

  col-14-width_locked:
    description:
    - >
      If set to true, locks the 'col-14-width' key to prevent user modification.
    type: bool
    default: false
  col-14-visible:
    description:
    - "Show process \u201CCommand Line\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-14-visible_locked:
    description:
    - >
      If set to true, locks the 'col-14-visible' key to prevent user modification.
    type: bool
    default: false
  col-15-width:
    description:
    - "Width of process \u201CMemory\u201D column"
    - Description - Schema Blank
    type: int
    default: 80

  col-15-width_locked:
    description:
    - >
      If set to true, locks the 'col-15-width' key to prevent user modification.
    type: bool
    default: false
  col-15-visible:
    description:
    - "Show process \u201CMemory\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: true

  col-15-visible_locked:
    description:
    - >
      If set to true, locks the 'col-15-visible' key to prevent user modification.
    type: bool
    default: false
  col-16-width:
    description:
    - "Width of process \u201CWaiting Channel\u201D column"
    - Description - Schema Blank
    type: int
    default: 48

  col-16-width_locked:
    description:
    - >
      If set to true, locks the 'col-16-width' key to prevent user modification.
    type: bool
    default: false
  col-16-visible:
    description:
    - "Show process \u201CWaiting Channel\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-16-visible_locked:
    description:
    - >
      If set to true, locks the 'col-16-visible' key to prevent user modification.
    type: bool
    default: false
  col-17-width:
    description:
    - "Width of process \u201CControl Group\u201D column"
    - Description - Schema Blank
    type: int
    default: 48

  col-17-width_locked:
    description:
    - >
      If set to true, locks the 'col-17-width' key to prevent user modification.
    type: bool
    default: false
  col-17-visible:
    description:
    - "Show process \u201CControl Group\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-17-visible_locked:
    description:
    - >
      If set to true, locks the 'col-17-visible' key to prevent user modification.
    type: bool
    default: false
  col-18-width:
    description:
    - "Width of process \u201CUnit\u201D column"
    - Description - Schema Blank
    type: int
    default: 70

  col-18-width_locked:
    description:
    - >
      If set to true, locks the 'col-18-width' key to prevent user modification.
    type: bool
    default: false
  col-18-visible:
    description:
    - "Show process \u201CUnit\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-18-visible_locked:
    description:
    - >
      If set to true, locks the 'col-18-visible' key to prevent user modification.
    type: bool
    default: false
  col-19-width:
    description:
    - "Width of process \u201CSession\u201D column"
    - Description - Schema Blank
    type: int
    default: 41

  col-19-width_locked:
    description:
    - >
      If set to true, locks the 'col-19-width' key to prevent user modification.
    type: bool
    default: false
  col-19-visible:
    description:
    - "Show process \u201CSession\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-19-visible_locked:
    description:
    - >
      If set to true, locks the 'col-19-visible' key to prevent user modification.
    type: bool
    default: false
  col-20-width:
    description:
    - "Width of process \u201CSeat\u201D column"
    - Description - Schema Blank
    type: int
    default: 59

  col-20-width_locked:
    description:
    - >
      If set to true, locks the 'col-20-width' key to prevent user modification.
    type: bool
    default: false
  col-20-visible:
    description:
    - "Show process \u201CSeat\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-20-visible_locked:
    description:
    - >
      If set to true, locks the 'col-20-visible' key to prevent user modification.
    type: bool
    default: false
  col-21-width:
    description:
    - "Width of process \u201COwner\u201D column"
    - Description - Schema Blank
    type: int
    default: 59

  col-21-width_locked:
    description:
    - >
      If set to true, locks the 'col-21-width' key to prevent user modification.
    type: bool
    default: false
  col-21-visible:
    description:
    - "Show process \u201COwner\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-21-visible_locked:
    description:
    - >
      If set to true, locks the 'col-21-visible' key to prevent user modification.
    type: bool
    default: false
  col-22-width:
    description:
    - "Width of process \u201CDisk read total\u201D column"
    - Description - Schema Blank
    type: int
    default: 100

  col-22-width_locked:
    description:
    - >
      If set to true, locks the 'col-22-width' key to prevent user modification.
    type: bool
    default: false
  col-22-visible:
    description:
    - "Show process \u201CDisk read total\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-22-visible_locked:
    description:
    - >
      If set to true, locks the 'col-22-visible' key to prevent user modification.
    type: bool
    default: false
  col-23-width:
    description:
    - "Width of process \u201CDisk write total\u201D column"
    - Description - Schema Blank
    type: int
    default: 100

  col-23-width_locked:
    description:
    - >
      If set to true, locks the 'col-23-width' key to prevent user modification.
    type: bool
    default: false
  col-23-visible:
    description:
    - "Show process \u201CDisk write total\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-23-visible_locked:
    description:
    - >
      If set to true, locks the 'col-23-visible' key to prevent user modification.
    type: bool
    default: false
  col-24-width:
    description:
    - "Width of process \u201CDisk read\u201D column"
    - Description - Schema Blank
    type: int
    default: 100

  col-24-width_locked:
    description:
    - >
      If set to true, locks the 'col-24-width' key to prevent user modification.
    type: bool
    default: false
  col-24-visible:
    description:
    - "Show process \u201CDisk read\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: true

  col-24-visible_locked:
    description:
    - >
      If set to true, locks the 'col-24-visible' key to prevent user modification.
    type: bool
    default: false
  col-25-width:
    description:
    - "Width of process \u201CDisk write\u201D column"
    - Description - Schema Blank
    type: int
    default: 100

  col-25-width_locked:
    description:
    - >
      If set to true, locks the 'col-25-width' key to prevent user modification.
    type: bool
    default: false
  col-25-visible:
    description:
    - "Show process \u201CDisk write\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: true

  col-25-visible_locked:
    description:
    - >
      If set to true, locks the 'col-25-visible' key to prevent user modification.
    type: bool
    default: false
  col-26-width:
    description:
    - "Width of process \u201CPriority\u201D column"
    - Description - Schema Blank
    type: int
    default: 100

  col-26-width_locked:
    description:
    - >
      If set to true, locks the 'col-26-width' key to prevent user modification.
    type: bool
    default: false
  col-26-visible:
    description:
    - "Show process \u201CPriority\u201D column on startup"
    - Description - Schema Blank
    type: bool
    default: false

  col-26-visible_locked:
    description:
    - >
      If set to true, locks the 'col-26-visible' key to prevent user modification.
    type: bool
    default: false
'''

EXAMPLES = r'''
- name: Configure and lock GNOME desktop settings for org.gnome.gnome-system-monitor.proctree
  org_gnome_gnome_system_monitor_proctree:
    sort-col: 8

    columns-order:
    - 0
    - 12

    sort-order: 0

    col-0-width: 225

    col-0-visible: true

    col-1-width: 98

    col-1-visible: false

    col-2-width: 37

    col-2-visible: false

    col-3-width: 90

    col-3-visible: false

    col-4-width: 90

    col-4-visible: false

    col-5-width: 90

    col-5-visible: false

    col-6-width: 90

    col-6-visible: false

    col-7-width: 90

    col-7-visible: false

    col-8-width: 71

    col-8-visible: true

    col-9-width: 80

    col-9-visible: false

    col-10-width: 70

    col-10-visible: false

    col-11-width: 48

    col-11-visible: false

    col-12-width: 60

    col-12-visible: true

    col-13-width: 80

    col-13-visible: false

    col-14-width: 120

    col-14-visible: false

    col-15-width: 80

    col-15-visible: true

    col-16-width: 48

    col-16-visible: false

    col-17-width: 48

    col-17-visible: false

    col-18-width: 70

    col-18-visible: false

    col-19-width: 41

    col-19-visible: false

    col-20-width: 59

    col-20-visible: false

    col-21-width: 59

    col-21-visible: false

    col-22-width: 100

    col-22-visible: false

    col-23-width: 100

    col-23-visible: false

    col-24-width: 100

    col-24-visible: true

    col-25-width: 100

    col-25-visible: true

    col-26-width: 100

    col-26-visible: false

'''

RETURN = r'''
# Default return values
'''

from ansible.module_utils.basic import AnsibleModule
import os
import configparser

def main():
    """Main function for the Ansible module."""
    # We have to do gross stuff with the bools here.
    keys_spec = {
        'sort-col': {
            'default': 8,
            'type': 'int',
            'gtype':'i',
        },
        'columns-order': {
            'default': [0, 12],
            'type': 'str',
            'gtype':'ai',
        },
        'sort-order': {
            'default': 0,
            'type': 'int',
            'gtype':'i',
        },
        'col-0-width': {
            'default': 225,
            'type': 'int',
            'gtype':'i',
        },
        'col-0-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-1-width': {
            'default': 98,
            'type': 'int',
            'gtype':'i',
        },
        'col-1-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-2-width': {
            'default': 37,
            'type': 'int',
            'gtype':'i',
        },
        'col-2-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-3-width': {
            'default': 90,
            'type': 'int',
            'gtype':'i',
        },
        'col-3-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-4-width': {
            'default': 90,
            'type': 'int',
            'gtype':'i',
        },
        'col-4-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-5-width': {
            'default': 90,
            'type': 'int',
            'gtype':'i',
        },
        'col-5-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-6-width': {
            'default': 90,
            'type': 'int',
            'gtype':'i',
        },
        'col-6-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-7-width': {
            'default': 90,
            'type': 'int',
            'gtype':'i',
        },
        'col-7-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-8-width': {
            'default': 71,
            'type': 'int',
            'gtype':'i',
        },
        'col-8-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-9-width': {
            'default': 80,
            'type': 'int',
            'gtype':'i',
        },
        'col-9-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-10-width': {
            'default': 70,
            'type': 'int',
            'gtype':'i',
        },
        'col-10-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-11-width': {
            'default': 48,
            'type': 'int',
            'gtype':'i',
        },
        'col-11-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-12-width': {
            'default': 60,
            'type': 'int',
            'gtype':'i',
        },
        'col-12-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-13-width': {
            'default': 80,
            'type': 'int',
            'gtype':'i',
        },
        'col-13-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-14-width': {
            'default': 120,
            'type': 'int',
            'gtype':'i',
        },
        'col-14-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-15-width': {
            'default': 80,
            'type': 'int',
            'gtype':'i',
        },
        'col-15-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-16-width': {
            'default': 48,
            'type': 'int',
            'gtype':'i',
        },
        'col-16-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-17-width': {
            'default': 48,
            'type': 'int',
            'gtype':'i',
        },
        'col-17-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-18-width': {
            'default': 70,
            'type': 'int',
            'gtype':'i',
        },
        'col-18-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-19-width': {
            'default': 41,
            'type': 'int',
            'gtype':'i',
        },
        'col-19-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-20-width': {
            'default': 59,
            'type': 'int',
            'gtype':'i',
        },
        'col-20-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-21-width': {
            'default': 59,
            'type': 'int',
            'gtype':'i',
        },
        'col-21-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-22-width': {
            'default': 100,
            'type': 'int',
            'gtype':'i',
        },
        'col-22-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-23-width': {
            'default': 100,
            'type': 'int',
            'gtype':'i',
        },
        'col-23-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-24-width': {
            'default': 100,
            'type': 'int',
            'gtype':'i',
        },
        'col-24-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-25-width': {
            'default': 100,
            'type': 'int',
            'gtype':'i',
        },
        'col-25-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
        'col-26-width': {
            'default': 100,
            'type': 'int',
            'gtype':'i',
        },
        'col-26-visible': {
            'default': False,
            'type': 'bool',
            'gtype':'b',
        },
    }

    argument_spec = {}
    for key_name, spec in keys_spec.items():
        argument_spec[key_name] = spec
        argument_spec[f"{key_name}_locked"] = {'type': 'bool', 'default': False}

    module = AnsibleModule(
        argument_spec=argument_spec,
        supports_check_mode=True
    )

    changed = False

    settings_dir = "/etc/dconf/db/local.d"
    locks_dir = os.path.join(settings_dir, "locks")

    settings_file_path = os.path.join(settings_dir, "00-ansible-org.gnome.gnome-system-monitor.proctree")
    lock_file_path = os.path.join(locks_dir, "ansible-org.gnome.gnome-system-monitor.proctree")

    schema_full_path = "/org/gnome/gnome-system-monitor/proctree/"
    config_section = schema_full_path.strip('/')

    os.makedirs(settings_dir, exist_ok=True)
    os.makedirs(locks_dir, exist_ok=True)

    # Idempotency: Read current settings
    current_settings = configparser.ConfigParser()
    if os.path.exists(settings_file_path):
        current_settings.read(settings_file_path)

    # Idempotency: Read current locks from our dedicated lock file
    current_locks = []
    if os.path.exists(lock_file_path):
        with open(lock_file_path, 'r') as f:
            current_locks = [line.strip() for line in f if line.strip()]

    # Prepare settings and locks based on module parameters
    new_settings = configparser.ConfigParser()
    new_settings.add_section(config_section)
    new_locks = []

    for key_name, spec in keys_spec.items():
        param_value = module.params[key_name]
        param_locked = module.params[f"{key_name}_locked"]

        if spec['type'] == 'bool':
            setting_value = str(param_value).lower()
        elif spec['type'] == 'str':
            setting_value = f'{param_value}'
        else:
            setting_value = str(param_value)

        new_settings.set(config_section, key_name, setting_value)

        if param_locked:
            new_locks.append(f"{schema_full_path}{key_name}")

    # Check for changes
    settings_changed = False
    if not current_settings.has_section(config_section) or \
       (current_settings.has_section(config_section) and dict(current_settings.items(config_section)) != dict(new_settings.items(config_section))):
        settings_changed = True

    locks_changed = sorted(new_locks) != sorted(current_locks)

    if settings_changed or locks_changed:
        changed = True

    if changed and not module.check_mode:
        # Write settings file
        with open(settings_file_path, 'w') as f:
            new_settings.write(f, space_around_delimiters=False)

        # Manage the dedicated lock file
        if new_locks:
            with open(lock_file_path, 'w') as f:
                for lock_key in new_locks:
                    f.write(f"{lock_key}\n")
        elif os.path.exists(lock_file_path):
            os.remove(lock_file_path)

        # Update dconf database
        module.run_command(["dconf", "update"], check_rc=True)

    module.exit_json(changed=changed)

if __name__ == '__main__':
    main()
